<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Planner de Estudos com IA (Rust)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --bg: #020617;
            --bg-soft: #020617;
            --card: #020617;
            --accent: #3b82f6;
            --accent-soft: rgba(59, 130, 246, 0.14);
            --accent-strong: rgba(59, 130, 246, 0.22);
            --text: #e5e7eb;
            --text-soft: #9ca3af;
            --border-subtle: #1e293b;
            --danger: #f97373;

            --radius-lg: 18px;
            --radius-md: 12px;

            --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.45);
            --shadow-lighter: 0 10px 26px rgba(15, 23, 42, 0.7);

            --font-body: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
            --transition-fast: 150ms ease-out;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: var(--font-body);
            background:
                    radial-gradient(circle at top, #0b1120 0, #020617 55%);
            color: var(--text);
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            font-size: 15px;
        }

        .app-shell {
            width: 100%;
            max-width: 1320px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-pill {
            width: 40px;
            height: 40px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 20%, #60a5fa, #2563eb);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: white;
            box-shadow: 0 12px 28px rgba(37, 99, 235, 0.55);
        }

        h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            letter-spacing: 0.01em;
        }

        header small {
            display: block;
            margin-top: 2px;
            font-size: 13px;
            color: var(--text-soft);
        }

        .pill-status {
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.26);
            background: rgba(15, 23, 42, 0.85);
            color: var(--text-soft);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .pill-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: #22c55e;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.18);
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
            gap: 24px;
        }

        @media (max-width: 900px) {
            body {
                padding: 24px 12px;
            }

            .layout {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .card {
            background:
                    radial-gradient(circle at top left, rgba(30, 64, 175, 0.08), transparent 55%),
                    linear-gradient(to bottom, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98));
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(15, 23, 42, 0.95);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.16), transparent 60%);
            opacity: 0.8;
        }

        .card-inner {
            position: relative;
            z-index: 1;
        }

        .section-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 10px;
        }

        .section-header h2 {
            margin: 0;
            font-size: 17px;
            font-weight: 600;
        }

        .section-header span {
            font-size: 12px;
            color: var(--text-soft);
        }

        .input-row {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        @media (max-width: 640px) {
            .input-row {
                flex-direction: column;
            }
        }

        label {
            display: block;
            margin-top: 12px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-soft);
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            margin-top: 6px;
            padding: 10px 12px;
            border-radius: 11px;
            border: 1px solid var(--border-subtle);
            background: rgba(15, 23, 42, 0.85);
            color: var(--text);
            font-size: 14px;
            outline: none;
            transition:
                    border-color var(--transition-fast),
                    box-shadow var(--transition-fast),
                    background var(--transition-fast),
                    transform 80ms ease-out;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            border-color: var(--accent);
            background: rgba(15, 23, 42, 0.98);
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.5);
            transform: translateY(-0.5px);
        }

        input::placeholder {
            color: rgba(148, 163, 184, 0.7);
        }

        .toggle-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-soft);
        }

        .toggle-row input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .subjects-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 18px;
            margin-bottom: 4px;
        }

        .subjects-header h3 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
        }

        .subjects-hint {
            font-size: 12px;
            color: var(--text-soft);
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.25);
            color: var(--text-soft);
        }

        .chip-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: #60a5fa;
        }

        .subjects-table {
            margin-top: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(15, 23, 42, 0.95);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid rgba(30, 64, 175, 0.65);
        }

        th,
        td {
            padding: 9px 10px;
            font-size: 13px;
            text-align: left;
            border-bottom: 1px solid rgba(15, 23, 42, 0.9);
        }

        th {
            background: linear-gradient(
                    to right,
                    rgba(15, 23, 42, 1),
                    rgba(15, 23, 42, 0.9)
            );
            font-weight: 500;
            color: rgba(209, 213, 219, 0.9);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background: rgba(15, 23, 42, 0.96);
        }

        .subjects-table input[type="text"],
        .subjects-table input[type="number"] {
            margin-top: 0;
            padding: 7px 8px;
            font-size: 12px;
            border-radius: 9px;
            background: rgba(15, 23, 42, 0.9);
        }

        .btn-ghost {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px dashed rgba(148, 163, 184, 0.55);
            background: transparent;
            color: var(--text-soft);
            font-size: 13px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition:
                    border-color var(--transition-fast),
                    background var(--transition-fast),
                    color var(--transition-fast),
                    transform 80ms ease-out;
        }

        .btn-ghost:hover {
            background: rgba(15, 23, 42, 0.9);
            border-style: solid;
            border-color: rgba(148, 163, 184, 0.9);
            color: #e5e7eb;
            transform: translateY(-1px);
        }

        .btn-ghost span {
            font-size: 16px;
            line-height: 1;
        }

        .btn-primary {
            margin-top: 18px;
            width: 100%;
            padding: 11px 14px;
            border-radius: 999px;
            border: none;
            outline: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            color: white;
            letter-spacing: 0.03em;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 16px 38px rgba(37, 99, 235, 0.65);
            transform: translateY(0);
            transition:
                    transform 80ms ease-out,
                    box-shadow 80ms ease-out,
                    filter var(--transition-fast);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            filter: brightness(1.03);
            box-shadow: 0 20px 48px rgba(37, 99, 235, 0.78);
        }

        .btn-primary:active {
            transform: translateY(0.5px);
            box-shadow: 0 10px 26px rgba(37, 99, 235, 0.55);
        }

        .btn-primary-icon {
            font-size: 15px;
        }

        /* RESULTADO */

        #result-card {
            min-height: 180px;
            box-shadow: var(--shadow-lighter);
        }

        #result {
            margin-top: 4px;
            font-size: 14px;
        }

        .small-muted {
            font-size: 12px;
            color: var(--text-soft);
            line-height: 1.5;
        }

        .mode-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            background: rgba(15, 23, 42, 0.95);
            color: var(--text-soft);
        }

        .badge-ai {
            background: var(--accent-soft);
            border-color: rgba(59, 130, 246, 0.8);
            color: #dbeafe;
        }

        .badge-local {
            background: rgba(31, 41, 55, 0.98);
            border-color: rgba(75, 85, 99, 0.85);
            color: #e5e7eb;
        }

        .result-table {
            margin-top: 10px;
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid rgba(30, 64, 175, 0.55);
            background: rgba(15, 23, 42, 0.98);
        }

        .result-table table {
            margin: 0;
            border: none;
        }

        .result-table th,
        .result-table td {
            padding: 10px 11px;
            font-size: 13px;
        }

        .result-table th {
            background: linear-gradient(
                    to right,
                    rgba(15, 23, 42, 0.98),
                    rgba(30, 64, 175, 0.62)
            );
            color: #e5e7eb;
        }

        .subject-cell {
            font-weight: 500;
        }

        .subject-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .subject-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #60a5fa;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.35);
        }

        .error-text {
            color: var(--danger);
            font-size: 13px;
            margin-top: 6px;
        }
    </style>
</head>
<body>
<div class="app-shell">
    <header>
        <div class="app-title">
            <div class="logo-pill">P</div>
            <div>
                <h1>Planner de Estudos com IA</h1>
                <small>Rust · Axum · Heurística + ChatGPT (opcional)</small>
            </div>
        </div>
        <div class="pill-status">
            <span class="pill-dot"></span>
            servidor local ativo
        </div>
    </header>

    <div class="layout">
        <!-- COLUNA ESQUERDA: FORM -->
        <div class="card">
            <div class="card-inner">
                <div class="section-header">
                    <h2>Configuração do dia</h2>
                    <span>Defina horas, início e foco</span>
                </div>

                <div class="input-row">
                    <div style="flex: 0.6;">
                        <label>Horas de estudo hoje</label>
                        <input type="number" id="total_hours" value="3" step="0.5" min="0.5" />
                    </div>
                    <div style="flex: 0.4;">
                        <label>Início (HH:MM)</label>
                        <input type="text" id="start_time" value="08:00" />
                    </div>
                </div>

                <label>Matéria foco principal <span style="font-weight:400;opacity:0.7;">(opcional)</span></label>
                <input type="text" id="focus" placeholder="Ex: Matemática" />

                <div class="toggle-row">
                    <input type="checkbox" id="use_ai" checked />
                    <span>Usar IA (ChatGPT) se disponível · <span style="opacity:0.7;">fallback local se falhar</span></span>
                </div>

                <div class="subjects-header">
                    <div>
                        <h3>Matérias</h3>
                        <div class="subjects-hint">Prioridade define quanto tempo cada uma recebe.</div>
                    </div>
                    <div class="chip">
                        <span class="chip-dot"></span>
                        sugestão: 3–5 matérias
                    </div>
                </div>

                <div class="subjects-table">
                    <table>
                        <thead>
                        <tr>
                            <th style="width: 44%;">Nome</th>
                            <th style="width: 18%;">Prioridade</th>
                            <th style="width: 24%;">Mín. minutos</th>
                            <th style="width: 14%;"></th>
                        </tr>
                        </thead>
                        <tbody id="subjects_body"></tbody>
                    </table>
                </div>

                <button id="add_subject_btn" type="button" class="btn-ghost">
                    <span>＋</span> Adicionar matéria
                </button>

                <button id="generate_btn" type="button" class="btn-primary">
                    <span class="btn-primary-icon">⚡</span>
                    Gerar rotina personalizada
                </button>
            </div>
        </div>

        <!-- COLUNA DIREITA: RESULTADO -->
        <div class="card" id="result-card">
            <div class="card-inner">
                <div class="section-header">
                    <h2>Sua rotina de hoje</h2>
                    <span>Visualize blocos, horários e matérias</span>
                </div>

                <div id="result">
                    <div class="small-muted">
                        Configure as informações ao lado e clique em <strong>Gerar rotina</strong> para ver o plano aqui.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const subjectsBody = document.getElementById("subjects_body");
    const addBtn = document.getElementById("add_subject_btn");
    const generateBtn = document.getElementById("generate_btn");
    const resultDiv = document.getElementById("result");

    function addSubjectRow(name = "", priority = 3, minMinutes = 30) {
        const tr = document.createElement("tr");

        tr.innerHTML = `
        <td>
          <input type="text" value="${name}" placeholder="Matéria" />
        </td>
        <td>
          <input type="number" value="${priority}" min="1" max="5" />
        </td>
        <td>
          <input type="number" value="${minMinutes}" min="10" step="5" />
        </td>
        <td style="text-align:center;">
          <button type="button" class="remove-btn" style="
            background: transparent;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 14px;
          " title="Remover matéria">
            ✕
          </button>
        </td>
      `;

        tr.querySelector(".remove-btn").addEventListener("click", () => {
            tr.remove();
        });

        subjectsBody.appendChild(tr);
    }

    // Linhas padrão
    addSubjectRow("Matemática", 5, 60);
    addSubjectRow("Física", 3, 30);
    addSubjectRow("Inglês", 2, 20);

    addBtn.addEventListener("click", () => addSubjectRow());

    generateBtn.addEventListener("click", async () => {
        const totalHours = parseFloat(document.getElementById("total_hours").value || "0");
        const startTime = document.getElementById("start_time").value || "08:00";
        const focus = document.getElementById("focus").value.trim();
        const useAi = document.getElementById("use_ai").checked;

        const subjects = [];
        subjectsBody.querySelectorAll("tr").forEach(tr => {
            const [nameInput, prioInput, minInput] = tr.querySelectorAll("input");
            const name = nameInput.value.trim();
            const priority = parseInt(prioInput.value || "3", 10);
            const minMinutes = parseInt(minInput.value || "30", 10);
            if (name) {
                subjects.push({ name, priority, min_minutes: minMinutes });
            }
        });

        if (!totalHours || subjects.length === 0) {
            alert("Informe pelo menos 0.5 horas e uma matéria.");
            return;
        }

        const payload = {
            total_hours: totalHours,
            start_time: startTime,
            subjects,
            focus: focus || null,
            use_ai: useAi
        };

        resultDiv.innerHTML = `
        <div class="small-muted">Gerando rotina... isso roda no seu backend em Rust.</div>
      `;

        try {
            const res = await fetch("/api/plan", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            });

            const data = await res.json();

            if (!res.ok) {
                resultDiv.innerHTML = `
            <div class="error-text"><strong>Erro:</strong> ${data.error || "Falha ao gerar plano."}</div>
          `;
                return;
            }

            const badgeClass = data.mode === "ai" ? "badge-ai" : "badge-local";
            const badgeLabel = data.mode === "ai" ? "IA (ChatGPT)" : "Heurística local";

            if (!data.blocks || data.blocks.length === 0) {
                resultDiv.innerHTML = `
            <div class="mode-pill ${badgeClass}">
              Modo: ${badgeLabel}
            </div>
            <p class="small-muted">Nenhum bloco gerado. Ajuste horas ou matérias e tente novamente.</p>
          `;
                return;
            }

            let html = `
          <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
            <div class="mode-pill ${badgeClass}">
              Modo: ${badgeLabel}
            </div>
            <div class="small-muted">
              Total de blocos: <strong>${data.blocks.length}</strong>
            </div>
          </div>

          <div class="result-table">
            <table>
              <thead>
                <tr>
                  <th>Início</th>
                  <th>Fim</th>
                  <th>Matéria</th>
                  <th>Minutos</th>
                </tr>
              </thead>
              <tbody>
        `;

            for (const b of data.blocks) {
                html += `
            <tr>
              <td>${b.start}</td>
              <td>${b.end}</td>
              <td class="subject-cell">
                <span class="subject-tag">
                  <span class="subject-dot"></span>
                  ${b.subject}
                </span>
              </td>
              <td>${b.minutes}</td>
            </tr>
          `;
            }

            html += `
              </tbody>
            </table>
          </div>

          <div class="small-muted">
            Use essa rotina como base e ajuste na prática. O objetivo é blocos claros e executáveis.
          </div>
        `;

            resultDiv.innerHTML = html;

        } catch (err) {
            console.error(err);
            resultDiv.innerHTML = `
          <div class="error-text">
            Erro inesperado no frontend. Veja o console para detalhes.
          </div>
        `;
        }
    });
</script>
</body>
</html>
